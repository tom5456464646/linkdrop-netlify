<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>LinkDrop</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#0b0c10; --card:#111319; --text:#e6e7ea; --muted:#a9adba; --primary:#4e8cff; --primary-press:#3e74d2;
      --stroke:#262937; --shadow:0 10px 24px rgba(0,0,0,.35);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --card:#fff; --text:#101218; --muted:#6b7280; --primary:#2563eb; --primary-press:#1e4fc0;
             --stroke:#e5e7eb; --shadow:0 10px 24px rgba(16,18,24,.08); }
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,sans-serif;
      -webkit-tap-highlight-color:transparent;
    }
    header.topbar{
      position:sticky; top:0; z-index:10;
      backdrop-filter:blur(8px);
      background:color-mix(in oklab,var(--bg) 92%, transparent);
      border-bottom:1px solid var(--stroke);
    }
    .topbar .inner{
      max-width:880px; margin:0 auto; padding:12px clamp(16px,4vw,24px);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{display:inline-flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.2px;}
    .brand .logo{
      width:28px; height:28px; border-radius:8px; display:grid; place-items:center;
      background:linear-gradient(135deg,var(--primary),#8a7bff); color:#fff; font-size:16px; box-shadow:var(--shadow);
    }

    .container{max-width:880px; margin:0 auto; padding:20px clamp(16px,4vw,24px) 32px;}
    .hero{margin:16px 0 12px;}
    .hero h1{margin:0 0 6px; font-size:clamp(22px,3.5vw,28px);}
    .hero p{margin:0; color:var(--muted);}

    .list{ display:grid; gap:12px; margin-top:16px; }
    .card{
      background:var(--card); border:1px solid var(--stroke); border-radius:14px; padding:14px; display:grid; gap:10px; box-shadow:var(--shadow);
    }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .title{ font-size:clamp(16px,2.8vw,18px); font-weight:650; word-break:break-word; }
    .meta{ color:var(--muted); font-size:13px; }
    /* Кнопка Перейти — ровная и аккуратная */
.btn {
  appearance: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;

  height: 48px;
  min-width: 180px;     /* одинаковая ширина */
  padding: 0 18px;

  border: 0;
  border-radius: 12px;
  background: var(--primary);
  color: #fff;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;

  box-shadow: var(--shadow);
  transition: transform .05s, background .2s, box-shadow .2s;
}
.btn:active { transform: translateY(1px); background: var(--primary-press); }
.btn:focus-visible { outline: none; box-shadow: var(--ring), var(--shadow); }

/* Выравнивание в строке карточки */
.row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
}

/* На узких экранах — кнопка на всю ширину под названием */
@media (max-width: 520px) {
  .row { gap: 10px; }
  .row .title { flex: 1 1 100%; }
  .row .btn { flex: 1 1 100%; min-width: 0; width: 100%; }
}
    .btn:active{ transform:translateY(1px); background:var(--primary-press); }

    .empty{
      margin:28px 0; padding:22px; border:1px dashed var(--stroke); border-radius:14px; color:var(--muted);
      text-align:center;
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="inner">
      <div class="brand"><div class="logo" aria-hidden="true">L</div><div>LinkDrop</div></div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Список фильмов</h1>
      <p class="muted">Открой на телевизоре и нажимай «Перейти» — ссылка откроется в новой вкладке.</p>
    </section>

    <section id="list" class="list" aria-live="polite"></section>
  </main>

  <script>
    const listEl = document.getElementById('list');

    function esc(s){
      return String(s)
        .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
        .replaceAll('"','&quot;').replaceAll("'","&#039;");
    }

    function render(items){
      if (!items.length){
        listEl.innerHTML = '<div class="empty">Пока пусто. Добавь ссылки на главной странице.</div>';
        return;
      }
      const frag = document.createDocumentFragment();
      for (const it of items){
        const created = new Date((it.created_at || 0) * 1000);
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="row">
            <div class="title">${esc(it.title || it.url)}</div>
            <a class="btn" href="${esc(it.url)}" target="_blank" rel="noopener noreferrer">Перейти</a>
          </div>
          <div class="meta">ID ${it.id} · ${created.toLocaleString()}</div>
        `;
        frag.appendChild(card);
      }
      listEl.innerHTML = '';
      listEl.appendChild(frag);
    }

    async function load(){
      try{
        const r = await fetch('/api/links', { cache:'no-store' });
        const data = await r.json();
        if (!data.ok) throw new Error(data.error || 'Ошибка API');
        render(data.items);
      }catch(e){
        listEl.innerHTML = '<div class="empty">Ошибка загрузки. Обновите страницу.';
      }
    }

    // автoобновление всегда включено
    load();
    setInterval(load, 5000);
  </script>
</body>
</html>
